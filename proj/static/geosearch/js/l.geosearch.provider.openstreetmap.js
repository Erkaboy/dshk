/**
 * L.Control.GeoSearch - search for an address and zoom to it's location
 * L.GeoSearch.Provider.OpenStreetMap uses openstreetmap geocoding service
 * https://github.com/smeijer/L.GeoSearch
 */
var polygon = gsch.polygon(
[[[55.86547851562501,45.081278612418764],[55.95336914062501,41.21998578493921],[57.2607421875,41.20345619205131],[57.15087890625001,41.82045509614034],[58.68896484375001,42.62587560259137],[59.97436523437501,41.75492216766298],[60.08422851562501,41.335575973123916],[61.71020507812501,41.03793062246529],[62.29248046875001,39.9602803542957],[62.29248046875001,39.9602803542957],[66.51672363281251,37.80544394934274],[66.51123046875001,37.801103690609615],[66.47827148437501,37.35269280367274],[67.84057617187501,37.09462150015557],[68.43933105468751,38.20365531807151],[68.43933105468751,38.20365531807151],[68.10150146484376,38.58896696823242],[68.26354980468751,39.00424469849724],[67.79388427734376,39.10022600175347],[67.39288330078126,39.281167913914636],[67.51373291015626,39.310925412127155],[67.48077392578126,39.49344386279539],[67.54943847656251,39.56547053068436],[67.72247314453126,39.61626788999703],[68.57116699218751,39.51251701659638],[68.67279052734376,39.82119422647455],[68.97216796875001,39.89498716884207],[68.97216796875001,39.89498716884207],[68.91723632812501,40.029717557833266],[69.05731201171876,40.096983167279575],[69.06005859375001,40.143189742924406],[69.04083251953126,40.17887331434698],[68.65081787109376,40.10748741901244],[68.57940673828126,40.12009038025332],[68.71124267578126,40.17257757632171],[69.05731201171876,40.214538129296336],[69.30175781250001,40.17047886718111],[69.33197021484376,40.25856876391262],[69.34295654296876,40.39467254512296],[69.26055908203126,40.534676780615435],[69.29626464843751,40.57849862511045],[69.37591552734376,40.57849862511045],[69.40612792968751,40.77846164090355],[69.66705322265626,40.62437645591559],[70.02960205078126,40.70979201243498],[70.46905517578126,40.948788179193485],[70.73822021484376,40.701463603604594],[70.29602050781251,40.47620304302563],[70.54321289062501,40.27952566881291],[70.63110351562501,40.16418235037417],[70.96618652343751,40.18726672309203],[71.00463867187501,40.02130468739707],[71.07330322265626,39.97922477476734],[71.05957031250001,39.89498716884207],[71.17218017578126,39.87812720644829],[71.24633789062501,39.93501296038254],[71.22711181640626,39.98974718404572],[71.06781005859376,40.27323927917308],[71.19689941406251,40.31513750307459],[71.19415283203126,40.317231732315236],[71.65008544921876,40.17467622056341],[71.72149658203126,39.930800820752765],[71.91925048828126,39.939224840791965],[71.85333251953126,40.17047886718111],[72.01538085937501,40.2313150803688],[72.08953857421876,40.29209669470104],[72.11151123046876,40.396764305572056],[72.17742919921876,40.440676262682395],[72.41638183593751,40.35910267579199],[72.48229980468751,40.39467254512296],[72.44384765625001,40.53050177574321],[72.70202636718751,40.50126945841645],[73.18542480468751,40.8034148344062],[73.18267822265626,40.865756786006806],[72.63061523437501,40.9052096972736],[72.45483398437501,41.0607151401866],[72.23510742187501,41.046216814520655],[72.20764160156251,41.17451935556445],[72.07031250000001,41.17038447781618],[71.92474365234376,41.20138969929042],[71.87805175781251,41.411835731001254],[71.72973632812501,41.57641597789269],[71.58142089843751,41.49006348843996],[71.57318115234376,41.35825713137815],[71.41937255859376,41.3025710943056],[71.40289306640626,41.18072118284585],[70.83160400390626,41.269549502842594],[70.77667236328126,41.46125371076152],[70.65307617187501,41.498292501398545],[70.53771972656251,41.44066745847661],[70.24108886718751,41.58668835697237],[71.34246826171876,42.18986405028881],[71.10900878906251,42.35042512243457],[70.54870605468751,42.132858175814626],[70.29327392578126,42.07376224008722],[69.93072509765626,41.7856490686444],[69.17541503906251,41.47977575214487],[68.65905761718751,41.05864414643029],[68.47778320312501,41.02135510866602],[68.61236572265626,40.60144147645398],[68.47503662109376,40.62646106367355],[68.05755615234376,40.82212357516945],[68.12622070312501,40.98197154086656],[68.17291259765626,41.06485693206886],[68.07952880859376,41.091772220976644],[68.01361083984376,41.11246878918088],[67.95593261718751,41.209655278807034],[66.73095703125001,41.17451935556445],[66.56204223632814,41.89307729913167],[66.02096557617189,41.95234127309011],[66.11572265625001,42.38187961091322],[66.12670898437501,42.65517191849825],[66.12808227539064,42.96747732655269],[65.85754394531251,42.879989517714826],[65.86303710937501,42.88401467044253],[65.53207397460939,43.37211393444652],[65.19973754882814,43.511708955963776],[64.97863769531251,43.75522505306928],[64.51583862304689,43.590338261467494],[64.51309204101564,43.58635949637695],[63.59161376953126,43.644025847699496],[63.25927734375001,43.67283828539736],[62.87887573242188,43.61122246320032],[61.99584960937501,43.538593801442374],[61.149215698242195,44.230440594623886],[61.11213684082032,44.381293541917195],[61.110076904296875,44.381784286142434],[58.60107421875001,45.65244828675087],[55.86547851562501,45.081278612418764]]]
    );


L.GeoSearch.Provider.OpenStreetMap = L.Class.extend({
    options: {},

    initialize: function(options) {
        options = L.Util.setOptions(this, options);
    },

    GetServiceUrl: function (qry) {
        var parameters = L.Util.extend({
            q: qry,
            format: 'json'
        }, this.options);

        return (location.protocol === 'https:' ? 'https:' : 'http:')
            + '//nominatim.openstreetmap.org/search'
            + L.Util.getParamString(parameters);
    },

    ParseJSON: function (data) {
        var results = [];

        for (var i = 0; i < data.length; i++) {


    var point = gsch.point([data[i].lon, data[i].lat]);
    var ptsWithin = gsch.booleanPointInPolygon(point, polygon);
          
             if(ptsWithin){
                var boundingBox = data[i].boundingbox,
                northEastLatLng = new L.LatLng( boundingBox[1], boundingBox[3] ),
                southWestLatLng = new L.LatLng( boundingBox[0], boundingBox[2] );

            if (data[i].address)
                data[i].address.type = data[i].type;

            results.push(new L.GeoSearch.Result(
                data[i].lon,
                data[i].lat,
                data[i].display_name,
                new L.LatLngBounds([
                    northEastLatLng,
                    southWestLatLng
                ]),
                data[i].address
            ));
        }
    }

        return results;
    }
});
