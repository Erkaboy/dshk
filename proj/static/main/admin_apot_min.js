$(document).on("click",".button_save_edit_apot",function(){data.append("csrfmiddlewaretoken",document.getElementsByName("csrfmiddlewaretoken")[0].value),data.append("confirm",$(this).attr("data-confirm")),data.append("apot_id",$(this).attr("data-apot_id")),$.ajax({url:"/save_edit_apot",data:data,cache:!1,contentType:!1,processData:!1,type:"post",success:function(a){-11!=a?(1==a?$("#myalert_content").html('<div class="alert alert-success">\n<p class="alert_p">O\'zgartirish muoffaqqiyatli amalga oshirildi. Oynani yangilang!</p>\n</div>'):$("#myalert_content").html('<div class="alert alert-success">\n<p class="alert_p">O\'zgartirish rad etildi. Oynani yangilang !</p>\n</div>'),$("#my_alert_modal")[0].click(),$(".button_save_edit_apot").prop("disabled","disabled")):console.log("Xatolik!!")},error:function(){console.log("Ajaxda xatolik!!")}})}),$(document).on("click",".button_save_new_apot",function(){data.append("csrfmiddlewaretoken",document.getElementsByName("csrfmiddlewaretoken")[0].value),data.append("apot_id",$(this).attr("data-apot_id")),data.append("confirm",$(this).attr("data-confirm")),$.ajax({url:"/save_apot",data:data,cache:!1,contentType:!1,processData:!1,type:"post",success:function(a){1==a&&($("#myalert_content").html('<div class="alert alert-success">\n<p class="alert_p">Saqlash muoffaqqiyatli amalga oshirildi. Oynani yangilang!</p>\n</div>'),$("#my_alert_modal")[0].click()),2==a&&($("#myalert_content").html('<div class="alert alert-success">\n<p class="alert_p">Rad etish muoffaqqiyatli amalga oshirildi. Oynani yangilang!</p>\n</div>'),$("#my_alert_modal")[0].click()),$(".button_save_new_apot").prop("disabled","disabled")},error:function(){console.log("Ajaxda xatolik!!")}})}),$(document).on("click",".button_delete_apot",function(){data.append("csrfmiddlewaretoken",document.getElementsByName("csrfmiddlewaretoken")[0].value),data.append("apot_id",$(this).attr("data-apot_id")),data.append("status",$(this).attr("data-status")),data.append("type","last_delete"),$.ajax({url:"/delete_apot",data:data,cache:!1,contentType:!1,processData:!1,type:"post",success:function(a){0==a&&($("#myalert_content").html('<div class="alert alert-success">\n<p class="alert_p">O\'chirish muoffaqqiyatli amalga oshirildi. Oynani yangilang!</p>\n</div>'),$("#my_alert_modal")[0].click()),a>0&&($("#myalert_content").html('<div class="alert alert-success">\n<p class="alert_p">Rad etildi. Oynani yangilang!</p>\n</div>'),$("#my_alert_modal")[0].click()),$(".button_delete_apot").prop("disabled","disabled"),$(".button_edit_apot").prop("disabled","disabled")},error:function(){console.log("Ajaxda xatolik!!")}})}),$(document).on("click",".button_delete_apot_admin",function(){data.append("csrfmiddlewaretoken",document.getElementsByName("csrfmiddlewaretoken")[0].value),data.append("apot_id",$(this).attr("data-apot_id")),data.append("confirm",$(this).attr("data-confirm")),data.append("type","admin_delete"),$.ajax({url:"/delete_apot",data:data,cache:!1,contentType:!1,processData:!1,type:"post",success:function(a){1==a&&($("#myalert_content").html('<div class="alert alert-success">\n<p class="alert_p">O\'chirish muoffaqqiyatli amalga oshirildi. Oynani yangilang!</p>\n</div>'),$("#my_alert_modal")[0].click()),2==a&&($("#myalert_content").html('<div class="alert alert-success">\n<p class="alert_p">Rad etildi. Oynani yangilang!</p>\n</div>'),$("#my_alert_modal")[0].click()),$(".button_delete_apot_admin").prop("disabled","disabled")},error:function(){console.log("Ajaxda xatolik!!")}})}),$("#button_create_apot_dialog").on("click",function(){var a=new FormData;a.append("csrfmiddlewaretoken",document.getElementsByName("csrfmiddlewaretoken")[0].value),$.ajax({url:"/list_sub_apot",data:a,cache:!1,contentType:!1,processData:!1,type:"post",success:function(a){var t="\n<div class='apot_edit_div' id='apot_edit_div_id' data-layer_id='-1' data-layer_status='1'>\n    <h2 class='title_sub_main'>Умумий маълумотлар</h2>\n    <hr class='hr_admin_tab'>\n\n<label for='apot_fy' class='label_admin_input'><span >Qishloq fuqarolar yig'ini nomi:</span></label> \n<input id=\"apot_fy\" type=\"text\" class = \"form-control\">\n\n<label for='apot_vil' class='label_admin_input'><span>Viloyat:</span></label> \n<select id=\"apot_vil\" class = \"form-control\">\n";for(var n in viloyat)t+="<option value='"+viloyat[n].id+"'>"+viloyat[n].disUz+"</option>";for(var l in t+='</select>\n<label for=\'apot_tum_shah\' class=\'label_admin_input\'><span >Tuman,shahar nomi:</span></label> \n<input id="apot_tum_shah" type="text" class = "form-control">\n\n<label for=\'apot_soata\' class=\'label_admin_input\'><span>Mamuriy hududiy_birliklarni belgilash tizimi kodi:</span></label> \n<input id="apot_soata" type="text" class = "form-control">\n\n<label for=\'apot_apt\' class=\'label_admin_input\'><span>Aholi punktining tipi:</span></label> \n<input id="apot_apt" type="text" class = "form-control">\n\n<label for=\'apot_apm\' class=\'label_admin_input\'><span>Aholi punktining maqomi:</span></label> \n<input id="apot_apm" type="text" class = "form-control">\n\n<label for=\'apot_lt\' class=\'label_admin_input\'><span>Loyihalash tashkiloti shahar chegarasi loyihasini ishlab chiquvchi:</span></label>\n<input id="apot_lt" type="text" class = "form-control">\n\n<label for=\'apot_shchsj\' class=\'label_admin_input\'><span>Shahar chegarasi loyihasi hujjatlari saqlandigan joy:</span></label> \n<input id="apot_shchsj" type="text" class = "form-control">\n\n\n<label for=\'apot_aplm\' class=\'label_admin_input\'><span>Aholi punktining loyihaviy maydoni ga:</span></label> \n<input id="apot_aplm" type="text" class = "form-control">\n\n<label for=\'apot_als\' class=\'label_admin_input\'><span>Aholining loyihaviy soni:</span></label> \n<input id="apot_als" type="text" class = "form-control">\n\n<label for=\'apot_qfym\' class=\'label_admin_input\'><span>QFY markazi:</span></label> \n<input id="apot_qfym" type="text" class = "form-control">\n\n<label for=\'apot_baps\' class=\'label_admin_input\'><span>Bo\'ysinuvchi aholi punktlari soni:</span></label> \n<input id="apot_baps" type="text" class = "form-control">\n\n<label for=\'apot_ichy\' class=\'label_admin_input\'><span>Ishlab chiqalgan yil:</span></label> \n<input id="apot_ichy" type="text" class = "form-control">\n\n<label for=\'apot_icha\' class=\'label_admin_input\'><span>Ishlab_ chiqarish asosi:</span></label> \n<input id="apot_icha" type="text" class = "form-control">\n\n<label for=\'apot_shkq\' class=\'label_admin_input\'><span>Shaharsozlik kengashi qarori:</span></label> \n<input id="apot_shkq" type="text" class = "form-control">\n\n<label for=\'apot_ast\' class=\'label_admin_input\'><span>Aholi soni tip:</span></label> \n<input id="apot_ast" type="text" class = "form-control">\n\n<label for=\'apot_thm\' class=\'label_admin_input\'><span>Tasdiqlanganlik holati</span></label> \n\n<select id="apot_thm" class = "form-control secret_inputs_checkbox">\n<option value=\'1\' >Tasdiqlangan</option>\n<option value=\'0\' >Tasdiqlanmagan</option>\n<option value=\'2\' selected >Ma\'lumot yo\'q</option>\n</select>\n\n<div  id=\'secret_inputs_div\' style=\'display:none;\'>\n\n<label for=\'apot_to\' class=\'label_admin_input\'><span>Shahar chegarasi loyihasini tasdiqlangan organ:</span></label> \n<input id="apot_to" type="text" class = "form-control ">\n\n<label for=\'apot_lhr\' class=\'label_admin_input\'><span >Shahar chegarasi loyiha tasdiqlash to\'g\'risidagi hujjat raqami va sanasi:</span></label> \n<input id="apot_lhr" type="text"  class = "form-control">\n</div>\n\n<table class="table dialog_table_main_tab">',a.sub_apot)t+='<tr><td><span class="head_admin_tab">'+a.sub_apot[l].nomi+"</span></td><td></td></tr>\n<tr>\n<td>\n<label class='form-control'>\n<input type='file' style='display:none;' class=\"input_file\" id='apot_sub_file_"+a.sub_apot[l].id+"'>\n<span class=\"span_admin_tab\">Faylni tanlang</span>\n</label>\n</td>\n<td style='width:70px;'>\n<input type='button' class=\"btn btn-danger\" id='delete_apot_sub_file_"+a.sub_apot[l].id+"' value='delete'>\n</td>\n</tr>";t+='\n\n</table>\n\n<br>\n    <input type="button" id="create_apot_button" class=\'btn btn-success\' value="Saqlash">\n    <input type="button" id="delete_apot_button" class=\'btn btn-danger\' value="Delete">\n  <div id="load_alert_div"></div>\n</div>',$("#modal_create_apot").html(t),$("#modal_create_apot").dialog("open")},error:function(){console.log("Ajaxda xatolik!!")}})}),$(document).on("click",".button_edit_apot",function(){data.append("csrfmiddlewaretoken",document.getElementsByName("csrfmiddlewaretoken")[0].value),data.append("apot_id",$(this).attr("data-apot_id")),data.append("status",$(this).attr("data-status")),$.ajax({url:"/edit_apot_dialog",data:data,cache:!1,contentType:!1,processData:!1,type:"post",success:function(a){var t=JSON.parse(a[0].apot_data),n=t.features[0].properties;t.features[0].geometry.coordinates.forEach(function(a,t){var n={type:"Polygon",coordinates:a};L.geoJson(n,{onEachFeature:function(a,t){drawnItems.addLayer(t)}})});var l="\n<div class='apot_edit_div' id='apot_edit_div_id' data-layer_id='"+a[0].apot_id+"' data-layer_status='"+a[0].status+"'>\n    <h2 class='title_sub_main'>Умумий маълумотлар</h2>\n    <hr class='hr_admin_tab'>\n\n<label for='apot_fy' class='label_admin_input'><span >Qishloq fuqarolar yig'ini nomi:</span></label> \n<input id=\"apot_fy\"  type=\"text\" class = \"form-control\">\n\n<label for='apot_vil' class='label_admin_input'><span>Viloyat:</span></label> \n<select id=\"apot_vil\" class = \"form-control\">\n";for(var i in viloyat)n.respublika_viloyat==viloyat[i].id?l+='<option selected value="'+viloyat[i].id+'" >'+viloyat[i].disUz+"</option>":l+='<option value="'+viloyat[i].id+'" >'+viloyat[i].disUz+"</option>";for(var e in l+='\n</select>\n<label for=\'apot_tum_shah\' class=\'label_admin_input\'><span >Tuman,shahar nomi:</span></label> \n<input id="apot_tum_shah"  type="text" class = "form-control">\n\n<label for=\'apot_soata\' class=\'label_admin_input\'><span>Mamuriy hududiy_birliklarni belgilash tizimi kodi:</span></label> \n<input id="apot_soata"  type="text" class = "form-control">\n\n<label for=\'apot_apt\' class=\'label_admin_input\'><span>Aholi punktining tipi:</span></label> \n<input id="apot_apt"  type="text" class = "form-control">\n\n<label for=\'apot_apm\' class=\'label_admin_input\'><span>Aholi punktining maqomi:</span></label> \n<input id="apot_apm"  type="text" class = "form-control">\n\n<label for=\'apot_lt\' class=\'label_admin_input\'><span>Loyihalash tashkiloti shahar chegarasi loyihasini ishlab chiquvchi:</span></label>\n<input id="apot_lt"  type="text" class = "form-control">\n<label for=\'apot_shchsj\' class=\'label_admin_input\'><span>Shahar chegarasi loyihasi hujjatlari saqlandigan joy:</span></label> \n<input id="apot_shchsj"  type="text" class = "form-control">\n\n<label for=\'apot_aplm\' class=\'label_admin_input\'><span>Aholi punktining loyihaviy maydoni ga:</span></label> \n<input id="apot_aplm"  type="text" class = "form-control">\n\n<label for=\'apot_als\' class=\'label_admin_input\'><span>Aholining loyihaviy soni:</span></label> \n<input id="apot_als"  type="text" class = "form-control">\n\n<label for=\'apot_qfym\' class=\'label_admin_input\'><span>QFY markazi:</span></label> \n<input id="apot_qfym"  type="text" class = "form-control">\n\n<label for=\'apot_baps\'  class=\'label_admin_input\'><span>Bo\'ysinuvchi aholi punktlari soni:</span></label> \n<input id="apot_baps"  type="text" class = "form-control">\n\n<label for=\'apot_ichy\' class=\'label_admin_input\'><span>Ishlab chiqalgan yil:</span></label> \n<input id="apot_ichy"  type="text" class = "form-control">\n\n<label for=\'apot_icha\' class=\'label_admin_input\'><span>Ishlab_ chiqarish asosi:</span></label> \n<input id="apot_icha"  type="text" class = "form-control">\n\n<label for=\'apot_shkq\' class=\'label_admin_input\'><span>Shaharsozlik kengashi qarori:</span></label> \n<input id="apot_shkq"  type="text" class = "form-control">\n\n<label for=\'apot_ast\' class=\'label_admin_input\'><span>Aholi soni tip:</span></label> \n<input id="apot_ast"  type="text" class = "form-control">\n\n\n<label for=\'apot_thm\' class=\'label_admin_input\'><span>Tasdiqlanganlik holati</span></label> \n<select id="apot_thm" class = "form-control secret_inputs_checkbox">',"1"==n.tasdiqlanganligi?l+="<option value='1'selected >Tasdiqlangan</option>\n       <option value='0'>Tasdiqlanmagan</option>\n       <option value='2' >Ma'lumot yo'q</option>":"0"==n.tasdiqlanganligi?l+="<option value='1' >Tasdiqlangan</option>\n      <option value='0' selected >Tasdiqlanmagan</option>\n      <option value='2' >Ma'lumot yo'q</option>":l+="<option value='1' >Tasdiqlangan</option>\n       <option value='0'  >Tasdiqlanmagan</option>\n       <option value='2' selected >Ma'lumot yo'q</option>",l+="</select>","1"==n.tasdiqlanganligi?l+="<div id='secret_inputs_div' style='display:block;'>":l+="<div id='secret_inputs_div' style='display:none;'>",l+='\n\n<label for=\'apot_to\' class=\'label_admin_input\'><span>Shahar chegarasi loyihasini tasdiqlangan organ:</span></label> \n<input id="apot_to"  type="text" class = "form-control ">\n\n<label for=\'apot_lhr\' class=\'label_admin_input\'><span >Shahar chegarasi loyiha tasdiqlash to\'g\'risidagi hujjat raqami va sanasi:</span></label> \n<input id="apot_lhr"  type="text"  class = "form-control">\n</div>\n\n\n<table class="table dialog_table_main_tab">',a[0].sub_apot)l+='<tr><td><span class="head_admin_tab">'+a[0].sub_apot[e].nomi+"</span></td><td></td></tr>\n<tr>\n<td>\n<label class='form-control'>\n<input type='file' style='display:none;' class=\"input_file\" id='apot_sub_file_"+a[0].sub_apot[e].id+"'>\n<span class=\"span_admin_tab\">Faylni tanlang</span>\n</label>\n</td>\n<td style='width:70px;'>\n<input type='button' class=\"btn btn-danger\" id='delete_apot_sub_file_"+a[0].sub_apot[e].id+"' value='delete'>\n</td>\n</tr>";for(var e in l+='\n\n</table>\n<br>\n    <input type="button" id="create_apot_button" class=\'btn btn-success\' value="O\'zgartirish">\n  <div id="load_alert_div"></div>\n</div>',$("#modal_create_apot").html(l),$("#modal_create_apot").dialog("open"),$("#apot_fy").val(n.fuqarolar_yiginlari),$("#apot_tum_shah").val(n.tuman_shahar),$("#apot_soata").val(n.mamuriy_hududiy_birliklarni_belgilash_tizimi_kodi),$("#apot_apt").val(n.aholi_punktining_tipi),$("#apot_apm").val(n.aholi_punktining_maqomi),$("#apot_lt").val(n.loyihalash_tashkiloti_shahar_chegarasi_loyihasini_ishlab_chiquv),$("#apot_shchsj").val(n.shahar_chegarasi_loyihasi_hujjatlari_saqlandigan_joy),$("#apot_aplm").val(n.aholi_punktining_loyihaviy_maydoni_ga),$("#apot_als").val(n.aholining_loyihaviy_soni),$("#apot_qfym").val(n.kfi_markazi),$("#apot_baps").val(n.boysinuvchi_aholi_punktlari_soni),$("#apot_ichy").val(n.ishlab_chiqalgan_yili),$("#apot_icha").val(n.ishlab_chiqarish_asosi),$("#apot_shkq").val(n.shaharsozlik_kengashi_qarori),$("#apot_ast").val(n.aholi_soni_tip),$("#apot_to").val(n.shahar_chegarasi_loyihasini_tasdiqlangan_organ),$("#apot_lhr").val(n.shahar_chegarasi_loyiha_tasdiqlash_tugrisidagi_hujjat_raqam_san),a[0].sub_apot_data)$("#apot_sub_file_"+a[0].sub_apot_data[e].sub_apot_id).parent().addClass("bg-success"),$("#apot_sub_file_"+a[0].sub_apot_data[e].sub_apot_id).next().text("Fayl biriktirilgan")},error:function(){console.log("Ajaxda xatolik!!")}})}),$(document).on("click","#delete_apot_button",function(){var a=new FormData;a.append("csrfmiddlewaretoken",document.getElementsByName("csrfmiddlewaretoken")[0].value),a.append("apot_id",$("#apot_edit_div_id").attr("data-layer_id")),a.append("type","first_delete"),$.ajax({url:"/delete_apot",data:a,cache:!1,contentType:!1,processData:!1,type:"post",success:function(a){1==a&&($("#apot_edit_div_id").attr("data-layer_id",-1),$("#apot_edit_div_id input[type='text']").each(function(){$(this).val("")}),$("input[id^='apot_sub_file_']").each(function(){$(this).val(""),$(this).parent().removeClass("bg-success"),$(this).next().text("Faylni tanlang")}),$("#load_alert_div").html("<p>O'chirildi !!</p>"),$("#load_alert_div").css({display:"block"}),$("#load_alert_div p").addClass("p_alert_admin_tab_success"))},error:function(){}})}),$(document).on("click","input[id^='delete_apot_sub_file_']",function(){var a=new FormData;a.append("csrfmiddlewaretoken",document.getElementsByName("csrfmiddlewaretoken")[0].value),a.append("apot_id",$("#apot_edit_div_id").attr("data-layer_id")),a.append("status",$("#apot_edit_div_id").attr("data-layer_status")),a.append("sub_apot_id",$(this).attr("id").split("_")[4]),$.ajax({url:"/delete_apot_data",data:a,cache:!1,contentType:!1,processData:!1,type:"post",success:function(a){$("#apot_edit_div_id").attr("data-layer_id",a.apot_id),$("#apot_edit_div_id").attr("data-layer_status",a.status),$('input[id="apot_sub_file_'+a.sub_apot_id+'"]').parent().removeClass("bg-success"),$('input[id="apot_sub_file_'+a.sub_apot_id+'"]').val(""),$('input[id="apot_sub_file_'+a.sub_apot_id+'"]').next().text("Faylni tanlang")},error:function(){console.log("Ajaxda xatolik !!")}})}),$(document).on("click",".delete_apot_main_files",function(){var a=new FormData;a.append("csrfmiddlewaretoken",document.getElementsByName("csrfmiddlewaretoken")[0].value),a.append("apot_id",$("#apot_edit_div_id").attr("data-layer_id")),a.append("status",$("#apot_edit_div_id").attr("data-layer_status")),a.append("type","main_files"),a.append("file_type",$(this).attr("data-file_type")),$.ajax({url:"/delete_apot_data",data:a,cache:!1,contentType:!1,processData:!1,type:"post",success:function(a){$("#apot_"+a.file_type).val(""),$("#apot_"+a.file_type).next().text("Faylni tanlang"),$("#apot_edit_div_id").attr("data-layer_id",a.apot_id),$("#apot_edit_div_id").attr("data-layer_status",a.status)},error:function(){console.log("Ajaxda xatolik !!")}})}),$("#modal_create_apot").dialog({resizable:!1,autoOpen:!1,height:700,width:550,modal:!1,dialogClass:"modal_create_apot",create:function(a){$(".modal_create_apot").children(".ui-dialog-titlebar").append("<button  type='button' class='img_mini_maxi' data-val='0'>-x-</button>")},close:function(){drawnItems.clearLayers()},show:{effect:"blind",duration:200},hide:{effect:"blind",duration:200}}),$(document).on("click","#create_apot_button",function(){if($("#load_alert_div").css({display:"none"}),0==drawnItems.toGeoJSON().features.length)$("#load_alert_div").html("<p>Vektorli ma'lumotlar kiritilmagan</p>"),$("#load_alert_div").css({display:"block"}),$("#load_alert_div p").addClass("p_alert_admin_tab_warning");else{var a,t=drawnItems.toGeoJSON().features[0].geometry.type;if("Polygon"==t){for(var n in a='{"type": "MultiPolygon","coordinates":[',t="polygon",drawnItems.toGeoJSON().features)a+=JSON.stringify(drawnItems.toGeoJSON().features[n].geometry.coordinates),n!=drawnItems.toGeoJSON().features.length-1&&(a+=",");a+="]}";var l=new FormData;l.append("csrfmiddlewaretoken",document.getElementsByName("csrfmiddlewaretoken")[0].value),l.append("apot_id",$("#apot_edit_div_id").attr("data-layer_id")),l.append("status",$("#apot_edit_div_id").attr("data-layer_status")),l.append("geometry",a),l.append("apot_vil",$("#apot_vil").val()),l.append("apot_thm",$("#apot_thm").val());var i=new Array;$("input[id^='apot_sub_file_']").each(function(a,t){t.files[0]&&(i.push($(this).attr("id").split("_")[3]),l.append("sub_apot_"+$(this).attr("id").split("_")[3],t.files[0]))}),l.append("itemsIndex",i.toString()),$("#apot_edit_div_id input[type='text']").each(function(){l.append($(this).attr("id"),$(this).val())}),$.ajax({url:"/create_apot",data:l,cache:!1,contentType:!1,processData:!1,type:"post",success:function(a){for(var t in a.sub_apot_ids)$('input[id="apot_sub_file_'+a.sub_apot_ids[t]+'"]').parent().addClass("bg-success"),$('input[id="apot_sub_file_'+a.sub_apot_ids[t]+'"]').val(""),$('input[id="apot_sub_file_'+a.sub_apot_ids[t]+'"]').next().text("Fayl biriktirilgan");$("#load_alert_div").html("<p>Saqlandi !!</p>"),$("#load_alert_div").css({display:"block"}),$("#load_alert_div p").addClass("p_alert_admin_tab_success"),$("#apot_edit_div_id").attr("data-layer_id",a.apot_id),$("#apot_edit_div_id").attr("data-layer_status",a.status)},error:function(){console.log("Ajaxda xatolik!!")}})}else $("#load_alert_div").html("<p>Vektorli ma'lumotda xatolik bor!!</p>"),$("#load_alert_div").css({display:"block"}),$("#load_alert_div p").addClass("p_alert_admin_tab_warning")}});